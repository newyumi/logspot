---
title: 이벤트 루프, 마이크로 태스크 큐
date: 2
version: "JS"
---

`이벤트 루프`는 JavaScript 코드 실행, 브라우저 렌더링, 비동기 작업 처리 등을 조율하는 핵심 메커니즘.
JavaScript는 단일 스레드로 작동하기 때문에 여러 작업을 동시에 처리할 수 없기 때문에 비동기 작업이 필요한 경우 이벤트 루프가 중요한 역할을 한다.

이벤트 루프는 콜 스택(Call Stack), 태스크 큐(Task Queue), 마이크로태스크 큐(Microtask Queue)\*\*로 이루어져 있음

- 콜 스택 (Call Stack): 함수 호출을 기록하는 스택. JavaScript 코드가 실행되면 해당 함수들이 콜 스택에 쌓이고 함수가 완료되면 스택에서 제거됨. 동기적 코드가 실행되는 곳.
- 태스크 큐 (Task Queue): 비동기 작업의 콜백 함수나 이벤트 핸들러가 대기하는 큐. 스택이 비워졌을 때 이벤트 루프가 이 큐에서 작업을 가져와 실행.
- 마이크로태스크 큐(Microtask Queue): 프로미스와 같이 우선적으로 처리되어야 하는 작업들이 대기하는 큐. 태스크 큐보다 우선순위 높음.
- 이벤트 루프 (Event Loop) 동작방식
  1. 콜 스택이 비어있는지 확인: 이벤트 루프는 콜 스택에 작업이 남아있는지 확인
  2. 마이크로태스크 큐 우선 처리: 콜 스택이 비었으면, 먼저 마이크로태스크 큐의 모든 작업을 실행. 마이크로태스크 큐는 항상 우선적으로 처리되며, 새 마이크로태스크가 추가될 때까지 실행을 반복.
  3. 태스크 큐에서 작업 실행: 마이크로태스크 큐가 비어있으면, 태스크 큐에서 작업을 하나 가져와 콜 스택에 추가하고 실행.
  4. 렌더링 업데이트: 브라우저는 필요할 경우 DOM 업데이트와 렌더링 작업을 수행. 이 작업은 일반적으로 모든 태스크가 완료된 후에 실행.

```javascript
console.log("Start");

setTimeout(() => {
  console.log("setTimeout");
}, 0);

Promise.resolve().then(() => {
  console.log("Promise Microtask");
});

console.log("End");

// 실행 결과
Start
End
Promise Microtask
setTimeout
```

위 코드에서는 setTimeout과 Promise가 비동기 작업. 이러한 비동기 작업은 콜 스택에 즉시 실행되지 않고 태스크 큐에 대기하게 된다. Promise.resolve()는 프로미스의 마이크로태스크 큐에 들어가게 된다. setTimeout은 0초 후에 실행되도록 설정되어 있지만, 실제로는 콜 스택이 비어있을 때 setTimeout과 Promise가 콜 스택으로 이동되어 실행된다.

<br/>

`마이크로 태스크 큐(microtask queue)`는 비동기 작업 중에서도 다른 비동기 작업보다 더 우선순위가 높은 작업을 위한 큐. 주로 Promise와 관련된 작업이 이 큐에 들어간다.

이벤트 루프는 콜 스택이 비어있을 때 먼저 마이크로 태스크 큐를 확인하고, 마이크로 태스크 큐에 작업이 있으면 해당 작업을 우선순위에 따라 콜 스택으로 이동시켜 실행. 마이크로 태스크 큐의 작업이 모두 완료되면 태스크 큐를 확인한다.
